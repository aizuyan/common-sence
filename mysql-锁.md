#mysql里面的锁
* 在mysql中`MyISAM`和`MEMORY`引擎采用表级锁(table-level locking)。
* `InnoDB`引擎支持行级锁(row-level locking)和表级锁，默认行级锁。
* mysql里面行级锁并不是直接锁记录，而是锁索引，索引分为主键索引和非主键索引，如果一条sql语句操作了主键索引，mysql就会锁住这条主键索引。如果一条语句操作了非主键索引，mysql会先锁定该非主键索引，在锁定相关的主键索引。

## 死锁的产生
两个或两个以上的进程在执行过程中，因争夺资源而造成的互相等待的现象，若无外力作用他们将一直等待下去。
表级锁不会出现死锁，死锁一般出现在InnoDB引擎上。

假设`连接A`执行`update`操作，使用的是非主键索引`idx_1`，mysql会先锁定相关的索引记录，由于条件是非主键索引，为执行该语句mysql还会锁定主键索引。
假设几乎同时来了个`连接B`，使用主键索引，要更新索引`idx_1`相关的字段，mysql会首先锁定主键索引记录，还需要锁定索引`idx_1`的相关索引记录。
这样，`连接A`锁定了索引`idx_1`的某些记录，等待主键索引，`连接B`锁定了主键索引记录，等待`idx_1`索引，这时候就产生了死锁。
